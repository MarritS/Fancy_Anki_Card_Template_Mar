<!-- =========================================================
  CARD STRUCTURE
  -------------------------------------------------------------
  This is the visible structure of the card.

  - .card-container wraps everything
  - .tag-container is where processed tags will be inserted
  - .front-card displays your {{Front}} field
========================================================= -->

<div class="card-container">
  <div class="tag-container" id="tagContainer"></div>
  <div class="front-card">
    {{Front}}
  </div>
</div>


<!-- =========================================================
  HIDDEN TAG SOURCE
  -------------------------------------------------------------
  {{Tags}} is provided by Anki as a single string, e.g.:

    "Biology::Cells Easy_Tag Another::Subtag"

  We hide it because we don't want to display the raw tag text.
  We only use it as input for JavaScript processing.
========================================================= -->

<span hidden id="tagSource">
  {{Tags}}
</span>


<script>
/* ============================================================
   TAG PROCESSING SCRIPT
   ------------------------------------------------------------
   What this script does:

   1. Reads the raw tag string from {{Tags}}
   2. Splits it into individual tags
   3. Removes hierarchical prefixes (keeps only last part after ::)
   4. Replaces underscores with spaces
   5. Creates styled tag elements
   6. Inserts them into .tag-container

   The entire script is wrapped in an IIFE so variables
   don't leak into the global scope.
============================================================ */

(() => {

  // Get references to required elements
  const tagSourceEl = document.getElementById("tagSource");
  const tagContainerEl = document.getElementById("tagContainer");

  // Stop if elements are missing (defensive coding)
  if (!tagSourceEl || !tagContainerEl) return;

  // Read raw tag string safely (textContent avoids HTML issues)
  const raw = (tagSourceEl.textContent || "").trim();

  // Stop if there are no tags
  if (!raw) return;

  /* ----------------------------------------------------------
     PROCESS TAG STRING

     raw example:
       "Biology::Cells Easy_Tag Another::Subtag"

     Steps:
       - Split by whitespace
       - Remove empty entries
       - Keep last segment after "::"
       - Replace "_" with " "
  ---------------------------------------------------------- */

  const tags = raw
    .split(/\s+/)
    .filter(Boolean)
    .map(t => t.split("::").pop())
    .map(t => t.replace(/_/g, " "));

  /* ----------------------------------------------------------
     CREATE TAG ELEMENTS

     We use a DocumentFragment as a temporary container.
     This avoids repeated DOM insertions.
  ---------------------------------------------------------- */

  const frag = document.createDocumentFragment();

  for (const label of tags) {
    const el = document.createElement("div");
    el.className = "tags";
    el.textContent = label;
    frag.appendChild(el);
  }

  // Insert all created tags into the visible container
  tagContainerEl.appendChild(frag);

})();
</script>