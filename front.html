<div class="card-container">

  <!-- Normal (always-visible) tags -->
  <div class="tag-container" id="tagContainer"></div>

  <!-- Question tags (qt*) appear directly above the question -->
  <div class="tag-container tag-container--question" id="qtContainer"></div>

  <div class="front-card">{{Front}}</div>
</div>

<span hidden id="tagSource">{{Tags}}</span>

<script>
/* ============================================================
   TAG RENDERING â€“ FRONT
   ------------------------------------------------------------
   normal tags   -> #tagContainer
   qt* (prefix)  -> #qtContainer (above question)
   ::at (suffix) -> hidden on front
   hid* (prefix) -> never shown
============================================================ */

(() => {
  const tagSourceEl = document.getElementById("tagSource");
  const normalEl = document.getElementById("tagContainer");
  const qtEl = document.getElementById("qtContainer");
  if (!tagSourceEl || !normalEl || !qtEl) return;

  const raw = (tagSourceEl.textContent || "").trim();
  if (!raw) return;

  // Prefix rules apply to the LAST hierarchy segment (same as before).
  const PREFIX = {
    qt:  /^qt(?:[:\-_ ]+|$)/i,
    hid: /^hid(?:[:\-_ ]+|$)/i
  };

  const stripPrefix = (s) => s.replace(/^(qt|hid)(?:[:\-_ ]+|$)/i, "").trim();

  const tokens = raw.split(/\s+/).filter(Boolean);

  const normal = [];
  const qt = [];

  for (const token of tokens) {
    const parts = token.split("::").filter(Boolean);
    if (!parts.length) continue;

    const last = parts[parts.length - 1];

    // hid prefix => never show
    if (PREFIX.hid.test(last)) continue;

    // qt prefix => question tags (display label = last segment without prefix)
    if (PREFIX.qt.test(last)) {
      const label = stripPrefix(last).replace(/_/g, " ");
      if (label) qt.push(label);
      continue;
    }

    // ::at suffix => answer-only tag; ignore on front
    if (last.toLowerCase() === "at") continue;

    // normal tag: display last hierarchy segment
    const label = last.replace(/_/g, " ").trim();
    if (label) normal.push(label);
  }

  const addPills = (container, labels, type) => {
    if (!labels.length) return;
    const frag = document.createDocumentFragment();
    for (const label of labels) {
      const el = document.createElement("div");
      el.className = `tags tags--${type}`;
      el.textContent = label;
      frag.appendChild(el);
    }
    container.appendChild(frag);
  };

  addPills(normalEl, normal, "normal");
  addPills(qtEl, qt, "question");

  if (!normalEl.children.length) normalEl.style.display = "none";
  if (!qtEl.children.length) qtEl.style.display = "none";
})();
</script>
