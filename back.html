<div class="card-container">

  <!-- Normal (always-visible) tags -->
  <div class="tag-container" id="tagContainer"></div>

  <!-- qt* tags above the question -->
  <div class="tag-container tag-container--question" id="qtContainer"></div>
  <div class="front-card">{{Front}}</div>

  <!-- at* tags above the answer (only shown on back) -->
  <div class="tag-container tag-container--answer" id="atContainer"></div>
  <div class="common-card">{{Back}}</div>

  {{#Extra}}
  <div class="common-card">
    <div class="subtitle">Extra Info</div>
    <div class="reminder">Hoef je niet te onthouden</div>
    {{Extra}}
  </div>
  {{/Extra}}

  {{#Hint}}
  <div class="common-card">
    <div class="subtitle">Ezelsbruggetje</div>
    {{Hint}}
  </div>
  {{/Hint}}

  {{#Source}}
  <div class="common-card">
    <div class="subtitle">Bron</div>
    {{Source}}
  </div>
  {{/Source}}

</div>

<span hidden id="tagSource">{{Tags}}</span>

<script>
/* ============================================================
   TAG RENDERING – BACK
   ------------------------------------------------------------
   normal tags  -> #tagContainer
   qt* tags     -> #qtContainer (above question)
   at* tags     -> #atContainer (above answer)
   hid* tags    -> never shown
============================================================ */

(() => {

  const tagSourceEl = document.getElementById("tagSource");
  const normalEl = document.getElementById("tagContainer");
  const qtEl = document.getElementById("qtContainer");
  const atEl = document.getElementById("atContainer");

  if (!tagSourceEl || !normalEl || !qtEl || !atEl) return;

  const raw = (tagSourceEl.textContent || "").trim();
  if (!raw) return;

  const PREFIX = {
    qt:  /^qt(?:[:\-_ ]+|$)/i,
    at:  /^at(?:[:\-_ ]+|$)/i,
    hid: /^hid(?:[:\-_ ]+|$)/i
  };

  const stripPrefix = (s) =>
    s.replace(/^(qt|at|hid)(?:[:\-_ ]+|$)/i, "");

  const parsedTags = raw
    .split(/\s+/)
    .filter(Boolean)
    .map(t => t.split("::").pop())
    .map(t => t.replace(/_/g, " "));

  const normal = [];
  const qt = [];
  const at = [];

  for (const tag of parsedTags) {

    if (PREFIX.hid.test(tag)) {
      // hid* → completely ignored
      continue;
    }

    if (PREFIX.qt.test(tag)) {
      qt.push(stripPrefix(tag).trim());
      continue;
    }

    if (PREFIX.at.test(tag)) {
      at.push(stripPrefix(tag).trim());
      continue;
    }

    normal.push(tag);
  }

  const addPills = (container, labels, type) => {
    if (!labels.length) return;

    const frag = document.createDocumentFragment();

    for (const label of labels) {
      if (!label) continue;

      const el = document.createElement("div");
      el.className = `tags tags--${type}`;
      el.textContent = label;

      frag.appendChild(el);
    }

    container.appendChild(frag);
  };

  addPills(normalEl, normal, "normal");
  addPills(qtEl, qt, "question");
  addPills(atEl, at, "answer");

  if (!normalEl.children.length) normalEl.style.display = "none";
  if (!qtEl.children.length) qtEl.style.display = "none";
  if (!atEl.children.length) atEl.style.display = "none";

})();
</script>