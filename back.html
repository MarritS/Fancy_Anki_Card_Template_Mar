<!-- =========================================================
  CARD STRUCTURE (BACK)
  -------------------------------------------------------------
  This is the visible layout of the back side:

  - Tag area (filled by JS)
  - Front shown again
  - Back answer
  - Optional sections:
      Extra (with subtitle + reminder)
      Hint
      Source
========================================================= -->

<div class="card-container">

  <!-- Tags get injected here -->
  <div class="tag-container" id="tagContainer"></div>

  <!-- Main content -->
  <div class="front-card">{{Front}}</div>
  <div class="common-card">{{Back}}</div>

  <!-- =======================================================
    OPTIONAL: EXTRA
    -----------------------------------------------------------
    Shown only when the Extra field is not empty.
  ======================================================= -->
  {{#Extra}}
  <div class="common-card">
    <div class="subtitle">Extra Info</div>
    <div class="reminder">Hoef je niet te onthouden</div>
		</br>
    {{Extra}}
  </div>
  {{/Extra}}

  <!-- =======================================================
    OPTIONAL: HINT
    -----------------------------------------------------------
    Shown only when Hint is not empty.
  ======================================================= -->
  {{#Hint}}
  <div class="common-card">
    <div class="subtitle">Ezelsbruggetje</div>
    {{Hint}}
  </div>
  {{/Hint}}

  <!-- =======================================================
    OPTIONAL: SOURCE
    -----------------------------------------------------------
    Shown only when Source is not empty.
  ======================================================= -->
  {{#Source}}
  <div class="common-card">
    <div class="subtitle">Bron</div>
    {{Source}}
  </div>
  {{/Source}}

</div>


<!-- =========================================================
  HIDDEN TAG SOURCE
  -------------------------------------------------------------
  {{Tags}} comes from Anki as one whitespace-separated string.
  We keep it hidden and let JS convert it into visible tag pills.
========================================================= -->

<span hidden id="tagSource">{{Tags}}</span>


<script>
/* ============================================================
   TAG PROCESSING SCRIPT (BACK)
   ------------------------------------------------------------
   What this script does:

   1. Reads the raw tag string from {{Tags}}
   2. Splits it into individual tags
   3. Keeps only the last part of hierarchical tags (after ::)
   4. Replaces underscores with spaces
   5. Creates <div class="tags"> elements for each tag
   6. Inserts them into #tagContainer

   Using textContent (instead of innerHTML) prevents any
   accidental HTML interpretation and is safer.
============================================================ */

(() => {
  const tagSourceEl = document.getElementById("tagSource");
  const tagContainerEl = document.getElementById("tagContainer");

  if (!tagSourceEl || !tagContainerEl) return;

  const raw = (tagSourceEl.textContent || "").trim();
  if (!raw) return;

  const tags = raw
    .split(/\s+/)
    .filter(Boolean)
    .map(t => t.split("::").pop())
    .map(t => t.replace(/_/g, " "));

  const frag = document.createDocumentFragment();

  for (const label of tags) {
    const el = document.createElement("div");
    el.className = "tags";
    el.textContent = label;
    frag.appendChild(el);
  }

  tagContainerEl.appendChild(frag);
})();
</script>